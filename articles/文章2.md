<p>我说另请高明吧，我实在也不是谦虚，我一个前端程序员怎么就要去做爬虫呢？但是，X晨同志讲，堃叔已经决定了你来开发。后来我就念了两句诗......</p>
<p>打住打住，这样怕不是我博客第二天就被爆破了？还是好好讲讲今天这篇文章要干嘛。</p>
<h4>开发一个抓取豆瓣Top250电影的博客并且进行数据可视化</h4>
<p>兜了一圈，最后还是回到我的本行了......(</p>
<p>还是上代码吧，技术栈经过知乎，V2EX，思否等查找，还是选择了<em>Scrapy</em>+<em>ECharts</em>。</p>
<h5>movies_items.py</h5>
<pre>
import scrapy\n
\n
class DoubanMoviesItem(scrapy.Item):\n
    # 排名\n
    ranking = scrapy.Field()\n
    # 电影名称\n
    movie_name = scrapy.Field()\n
    # 电影简介\n
    movie_board = scrapy.Field()\n
    # 评分\n
    score = scrapy.Field()\n
    # 评论人数\n
    score_num = scrapy.Field()
</pre>
<br/>
<h5>movies_spider.py</h5>
<pre>
import scrapy\n
from .movies_items import DoubanMoviesItem\n
\n
class MoviesSpider(scrapy.Spider):\n
    name = 'douban_movies_top250'\n
\n
    def start_requests(self):\n
        urls = ['https://movie.douban.com/top250']\n
        for url in urls:\n
            yield scrapy.Request(url, callback=self.parse)\n
\n
    def parse(self, response):\n
        item = DoubanMoviesItem()\n
        for movie in response.css('ol.grid_view li'):\n
            item['ranking'] = movie.css('div.pic em::text').extract_first(),\n
            item['movie_name'] = movie.css('div.hd span.title::text').extract_first(),\n
            item['movie_board'] = '%s%s' % ( movie.css('div.bd p::text').extract()[0], movie.css('div.bd p::text').extract()[1])\n
            item['score'] = movie.css('div.star span.rating_num::text').extract_first(),\n
            item['score_num'] = movie.css('div.star span')[3].css('span::text').extract_first()\n
            yield item\n
        next_url = response.css('div.paginator span.next a::attr(href)') .extract_first()\n
        if next_url:\n
            next_url = 'https://movie.douban.com/top250' + next_url\n
            yield scrapy.Request(next_url, callback=self.parse)
</pre>
<p>以上，其实并没有多大难度。主要还是大幅度参考<em>Scrapy</em>文档的一些东西，作为一名前端程序员，使用<em>CSS</em>的喜好肯定要大于<em>Xpath</em>的。难点在于模拟浏览器和中文乱码的问题，这些都可以在settings.py中解决：</p>
<pre>
DEFAULT_REQUEST_HEADERS = {\n
    'Connection': 'keep-alive',\n
    'Upgrade-Insecure-Requests': '1',\n  
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)\n Chrome/65.0.3325.181 Safari/537.36',\n
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n  
    'Accept-Language': 'zh-CN,zh;q=0.8'\n  
}\n
FEED_EXPORT_ENCODING = 'utf-8' 
</pre>
<p>这样就可以了，最后还有一个比较坑的地方是如果要生成.csv格式的文件，excel貌似有点水土不服，还是WPS好用一点。</p>
<p>这是我第一次进行技术写作，希望大家多多包容，此外是有要学习<em>Markdown</em>的必要了。。</p>
<p>下一篇文章见，米娜</p>